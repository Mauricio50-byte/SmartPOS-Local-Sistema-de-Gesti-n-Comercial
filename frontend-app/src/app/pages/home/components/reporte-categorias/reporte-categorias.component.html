<div class="report-container">
  
  <div class="report-header">
    <div>
      <h2 class="page-title">Informe de Ventas por Categoría</h2>
      <p class="page-subtitle">Análisis detallado de rendimiento y rentabilidad</p>
    </div>
    <div class="header-actions">
      <ion-button fill="outline" (click)="loadData()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Actualizar
      </ion-button>
    </div>
  </div>

  <div *ngIf="!dataLoaded" class="loading-state">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Generando informe...</p>
  </div>

  <div *ngIf="dataLoaded" class="report-content">
    
    <!-- Resumen Ejecutivo (Análisis) -->
    <div class="executive-summary" *ngIf="metrics.length > 0">
      <div class="summary-card best-performer">
        <div class="card-icon">
          <ion-icon name="trophy-outline"></ion-icon>
        </div>
        <div class="card-content">
          <h4>Categoría Líder</h4>
          <span class="highlight">{{ getBestCategory()?.name }}</span>
          <p>Representa el <strong>{{ getBestCategory()?.share | number:'1.0-1' }}%</strong> de las ventas totales.</p>
        </div>
      </div>

      <div class="summary-card recommendation">
        <div class="card-icon">
          <ion-icon name="bulb-outline"></ion-icon>
        </div>
        <div class="card-content">
          <h4>Insight Estratégico</h4>
          <p *ngIf="getBestCategory()?.margin! < 20">
            Atención: Tu categoría líder tiene bajo margen ({{ getBestCategory()?.margin | number:'1.0-1' }}%). Considera optimizar costos.
          </p>
          <p *ngIf="getBestCategory()?.margin! >= 20">
            Excelente rendimiento en {{ getBestCategory()?.name }} con márgenes saludables. Potencia su inventario.
          </p>
        </div>
      </div>
    </div>

    <!-- Gráficos -->
    <div class="charts-grid">
      <div class="chart-card">
        <h3>Comparativa de Ingresos</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [data]="barChartData"
            [options]="barChartOptions"
            type="bar">
          </canvas>
        </div>
      </div>
      <div class="chart-card">
        <h3>Participación de Mercado</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [data]="pieChartData"
            [options]="pieChartOptions"
            type="pie">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Tabla de Datos -->
    <div class="data-table-card">
      <h3>Detalle de Categorías</h3>
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th (click)="toggleSort('name')">Categoría</th>
              <th (click)="toggleSort('revenue')" class="text-right">Ventas ($)</th>
              <th (click)="toggleSort('salesVolume')" class="text-right">Volumen</th>
              <th (click)="toggleSort('margin')" class="text-right">Margen (%)</th>
              <th (click)="toggleSort('growth')" class="text-right">Crecimiento</th>
              <th (click)="toggleSort('share')" class="text-right">Participación</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let m of metrics">
              <td class="font-medium">{{ m.name }}</td>
              <td class="text-right">{{ m.revenue | currency:'USD':'symbol':'1.0-0' }}</td>
              <td class="text-right">{{ m.salesVolume }}</td>
              <td class="text-right">
                <span [class.text-success]="m.margin >= 30" [class.text-warning]="m.margin < 30">
                  {{ m.margin | number:'1.1-1' }}%
                </span>
              </td>
              <td class="text-right">
                <span [class.text-success]="m.growth > 0" [class.text-danger]="m.growth < 0">
                  {{ m.growth > 0 ? '+' : '' }}{{ m.growth | number:'1.1-1' }}%
                </span>
              </td>
              <td class="text-right">{{ m.share | number:'1.1-1' }}%</td>
            </tr>
            <tr *ngIf="metrics.length === 0">
              <td colspan="6" class="text-center">No hay datos de ventas para el periodo actual.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

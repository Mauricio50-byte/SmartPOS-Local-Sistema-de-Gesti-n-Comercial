<div class="usuarios-container">
  <div class="page-header">
    <h2>Gestión de Usuarios</h2>
    <ion-button color="primary" (click)="mostrarFormularioCrear()">
      Crear Nuevo Usuario
    </ion-button>
  </div>

  <!-- Lista de usuarios -->
  <div class="usuarios-grid">
    <!-- Lista dinámica de usuarios desde la BD -->
    <div *ngFor="let usuario of usuarios" class="usuario-card">
      <div class="usuario-avatar" [class.trabajador]="usuario.roles && usuario.roles.includes('trabajador')">
        <ion-icon name="person-circle"></ion-icon>
      </div>
      <div class="usuario-info">
        <h3 class="usuario-nombre">{{usuario.nombre}}</h3>
        <p class="usuario-rol">{{usuario.roles && usuario.roles.length > 0 ? usuario.roles[0] : 'Sin rol'}}</p>
        <p class="usuario-correo">{{usuario.correo}}</p>
      </div>
      <div class="usuario-status">
        <span class="badge" [class.activo]="usuario.activo" [class.inactivo]="!usuario.activo">
          {{usuario.activo ? 'Activo' : 'Inactivo'}}
        </span>
      </div>
      <div class="usuario-actions">
        <ion-button fill="clear" size="small" (click)="editarUsuario(usuario)">
          <ion-icon slot="icon-only" name="create-outline"></ion-icon>
        </ion-button>
        <ion-button fill="clear" size="small" [color]="usuario.activo ? 'danger' : 'success'" (click)="toggleEstadoUsuario(usuario)">
          <ion-icon slot="icon-only" [name]="usuario.activo ? 'power-outline' : 'power-outline'"></ion-icon>
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Estado vacío -->
  <div *ngIf="usuarios.length === 0" class="empty-state">
    <ion-icon name="people-outline"></ion-icon>
    <h3>No hay usuarios adicionales</h3>
    <p>Los usuarios predeterminados se muestran arriba</p>
  </div>
</div>

<!-- Modal para crear usuario -->
<ion-modal [isOpen]="mostrarFormulario" (didDismiss)="cerrarFormulario()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Crear Nuevo Usuario</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="cerrarFormulario()">
            <ion-icon name="close" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content class="ion-padding">
      <form [formGroup]="formgroup" (ngSubmit)="guardarUsuario()">
        <ion-item class="form-item">
          <ion-label position="floating">Nombre</ion-label>
          <ion-input formControlName="nombre" type="text"></ion-input>
        </ion-item>

        <ion-item class="form-item">
          <ion-label position="floating">Correo</ion-label>
          <ion-input formControlName="correo" type="email"></ion-input>
        </ion-item>

        <ion-item class="form-item">
          <ion-label position="floating">Contraseña</ion-label>
          <ion-input formControlName="passwordHash" type="password"></ion-input>
        </ion-item>

        <ion-item class="form-item">
          <ion-label>Rol</ion-label>
          <ion-select formControlName="rol" placeholder="Seleccionar rol">
            <ion-select-option value="administrador">Administrador</ion-select-option>
            <ion-select-option value="trabajador">Trabajador</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item class="form-item">
          <ion-label>Estado</ion-label>
          <ion-select formControlName="activo" placeholder="Seleccionar estado">
            <ion-select-option [value]="true">Activo</ion-select-option>
            <ion-select-option [value]="false">Inactivo</ion-select-option>
          </ion-select>
        </ion-item>

        <div class="form-actions">
          <ion-button expand="block" type="submit" color="primary" [disabled]="formgroup.invalid">
            <ion-icon slot="start" name="add-circle-outline"></ion-icon>
            Crear Usuario
          </ion-button>
        </div>
      </form>
    </ion-content>
  </ng-template>
</ion-modal>

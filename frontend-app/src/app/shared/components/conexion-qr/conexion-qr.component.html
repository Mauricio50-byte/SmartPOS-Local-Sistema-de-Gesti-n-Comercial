<ion-header class="ion-no-border">
    <ion-toolbar>
        <ion-title class="modal-title">Conectar Dispositivo</ion-title>
        <ion-buttons slot="end">
            <ion-button (click)="cerrar()" color="medium">
                <ion-icon name="close-outline" size="large"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding content-bg">
    
    <div class="main-container">
        <ion-grid fixed>
            <ion-row>
                <!-- COLUMNA IZQUIERDA: CONFIGURACIÓN -->
                <ion-col size="12" size-md="6" class="config-col">
                    
                    <div class="step-card">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <h4>Modo Online (Internet)</h4>
                        </div>
                        
                        <div class="ion-margin-top">
                            <p class="step-desc">Pega aquí la URL generada por el script <code>iniciar_nube_segura.bat</code>.</p>
                            
                            <div class="ip-input-wrapper">
                                <ion-item lines="none" class="custom-input">
                                    <ion-label position="stacked">URL del Túnel Seguro</ion-label>
                                    <ion-input [(ngModel)]="urlPublica" placeholder="Ej: https://xxxx-xxxx.trycloudflare.com"></ion-input>
                                    <ion-icon name="cloud-outline" slot="start" color="success"></ion-icon>
                                </ion-item>
                                
                                <ion-button expand="block" (click)="generarQr()" class="ion-margin-top">
                                    <ion-icon name="qr-code-outline" slot="start"></ion-icon>
                                    Generar QR
                                </ion-button>

                                <ion-note color="medium" style="font-size: 0.8rem; display: block; margin-top: 5px;">
                                    El trabajador iniciará sesión con sus propias credenciales.
                                </ion-note>
                            </div>
                        </div>
                    </div>

                    <div class="step-card help-card">
                        <div class="step-header">
                            <div class="step-number">?</div>
                            <h4>¿Cómo funciona?</h4>
                        </div>
                        <ul class="help-list">
                            <li>Ejecuta el archivo <b>iniciar_nube_segura.bat</b> en el escritorio.</li>
                            <li>Copia el enlace que termina en <b>.trycloudflare.com</b>.</li>
                            <li>Pégalo aquí y escanea el QR.</li>
                        </ul>
                    </div>

                </ion-col>

                <!-- COLUMNA DERECHA: QR -->
                <ion-col size="12" size-md="6" class="qr-col">
                    <div class="qr-card">
                        <h3>Escanear Código</h3>
                        <p class="qr-instruction">Abre la cámara o App en tu celular</p>
                        
                        <div class="qr-wrapper">
                            <canvas #qrCanvas></canvas>
                        </div>

                        <div class="url-section">
                            <p class="url-label">Enlace Directo</p>
                            <div class="url-box">
                                <span class="url-text">{{ urlQr || 'Esperando URL...' }}</span>
                                <ion-button fill="clear" size="small" (click)="copiarUrl()" [disabled]="!urlQr">
                                    <ion-icon name="copy-outline" slot="icon-only"></ion-icon>
                                </ion-button>
                            </div>
                        </div>
                    </div>
                </ion-col>
            </ion-row>
        </ion-grid>
    </div>

</ion-content>
